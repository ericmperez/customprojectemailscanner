<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Licitaciones Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>ğŸ“‹ Licitaciones Dashboard</h1>
                <div class="stats-bar" id="statsBar">
                    <div class="stat-item pending">
                        <span class="stat-label">Pendientes</span>
                        <span class="stat-value" id="statPending">0</span>
                    </div>
                    <div class="stat-item approved">
                        <span class="stat-label">Aprobadas</span>
                        <span class="stat-value" id="statApproved">0</span>
                    </div>
                    <div class="stat-item rejected">
                        <span class="stat-label">Rechazadas</span>
                        <span class="stat-value" id="statRejected">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Filters -->
        <div class="filters">
            <div class="filter-group search-group">
                <label for="searchInput">ğŸ” Buscar:</label>
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Buscar por tÃ­tulo, ubicaciÃ³n, descripciÃ³n, PDF, contacto..."
                    class="search-input"
                />
            </div>

            <div class="filter-group">
                <label for="sortSelect">ğŸ”€ Ordenar:</label>
                <select id="sortSelect">
                    <option value="">Sin ordenar</option>
                    <option value="visit-date-asc">ğŸ“… Visita mÃ¡s cercana</option>
                    <option value="close-date-asc">â° Cierre mÃ¡s cercano</option>
                    <option value="email-date-desc">ğŸ“§ MÃ¡s reciente</option>
                    <option value="email-date-asc">ğŸ“§ MÃ¡s antigua</option>
                    <option value="title-asc">ğŸ”¤ A-Z (TÃ­tulo)</option>
                    <option value="title-desc">ğŸ”¤ Z-A (TÃ­tulo)</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="statusFilter">Estado:</label>
                <select id="statusFilter">
                    <option value="">Todos</option>
                    <option value="pending" selected>Pendientes</option>
                    <option value="approved">Aprobadas</option>
                    <option value="rejected">Rechazadas</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="categoryFilter">CategorÃ­a:</label>
                <select id="categoryFilter">
                    <option value="">Todas</option>
                    <option value="Suministros">Suministros</option>
                    <option value="Servicios">Servicios</option>
                    <option value="ConstrucciÃ³n">ConstrucciÃ³n</option>
                    <option value="Obras">Obras</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="typeFilter">Tipo:</label>
                <select id="typeFilter">
                    <option value="">Todos</option>
                    <option value="visits">Visitas</option>
                    <option value="purchases">Compras</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="dateRangeFilter">Rango de fechas:</label>
                <select id="dateRangeFilter">
                    <option value="">Todas las fechas</option>
                    <option value="next-week">PrÃ³xima semana</option>
                    <option value="next-2-weeks">PrÃ³ximas 2 semanas</option>
                    <option value="next-month">PrÃ³ximo mes</option>
                    <option value="this-week">Esta semana</option>
                    <option value="today">Hoy</option>
                    <option value="past">Pasadas</option>
                    <option value="visits-this-week">ğŸ—ï¸ Visitas esta semana</option>
                    <option value="visits-next-week">ğŸ—ï¸ Visitas prÃ³xima semana</option>
                    <option value="visits-next-2-weeks">ğŸ—ï¸ Visitas prÃ³ximas 2 semanas</option>
                </select>
            </div>

            <div class="quick-actions">
                <button class="btn btn-quick" onclick="quickFilterVisitsThisWeek()">ğŸ—ï¸ Visitas esta semana</button>
                <button class="btn btn-quick" onclick="quickFilterClosingSoon()">â° Cierre pronto (7 dÃ­as)</button>
                <button class="btn btn-quick" onclick="quickFilterPendingVisits()">ğŸ“ Visitas pendientes</button>
                <button class="btn btn-quick" onclick="showOnlyFavorites()">â­ Favoritos</button>
            </div>

            <button class="btn btn-secondary" onclick="clearFilters()">Limpiar Filtros</button>
            <button class="btn btn-secondary" onclick="exportAllFiltered()">ğŸ“¥ Exportar a CSV</button>
            <button class="btn btn-secondary" onclick="exportToICalendar()">ğŸ“… Exportar Visitas (.ics)</button>
            <button class="btn btn-secondary" id="calendarToggleBtn">ğŸ“† Ver Calendario</button>
            
            <div class="view-mode-toggle">
                <button class="btn view-mode-btn active" id="viewModeCards" onclick="setViewMode('cards')" title="Vista de tarjetas">âŠ</button>
                <button class="btn view-mode-btn" id="viewModeList" onclick="setViewMode('list')" title="Vista de lista">â˜°</button>
                <button class="btn view-mode-btn" id="viewModeTable" onclick="setViewMode('table')" title="Vista de tabla">âŠŸ</button>
            </div>
            
            <button class="btn btn-primary" onclick="loadLicitaciones()">ğŸ”„ Refrescar</button>
            <button class="btn btn-link" id="notificationsToggle" onclick="toggleNotifications()" title="Activar notificaciones">ğŸ””</button>
            <button class="btn btn-link" onclick="showKeyboardShortcutsHelp()" title="Mostrar atajos de teclado">âŒ¨ï¸ ?</button>
        </div>

        <!-- Smart Suggestions -->
        <div id="smartSuggestions" class="smart-suggestions" style="display: none;"></div>

        <!-- Bulk Actions Bar -->
        <div id="bulkActionsBar" class="bulk-actions-bar" style="display: none;">
            <div class="bulk-info">
                <span id="bulkSelectedCount">0</span> seleccionada(s)
            </div>
            <div class="bulk-buttons">
                <button class="btn btn-success btn-sm" onclick="bulkApprove()">âœ“ Aprobar seleccionadas</button>
                <button class="btn btn-danger btn-sm" onclick="bulkReject()">âœ— Rechazar seleccionadas</button>
                <button class="btn btn-secondary btn-sm" onclick="exportSelected()">ğŸ“Š Exportar seleccionadas</button>
                <button class="btn btn-secondary btn-sm" onclick="clearSelection()">Limpiar selecciÃ³n</button>
            </div>
        </div>

        <div id="cardsContainer">
            <!-- Loading State -->
            <div id="loadingState" class="loading-state" style="display: none;">
                <div class="spinner"></div>
                <p>Cargando licitaciones...</p>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <p>ğŸ“­ No hay licitaciones que coincidan con los filtros seleccionados</p>
            </div>

            <!-- Cards Grid -->
            <div class="cards-grid" id="cardsGrid">
                <!-- Cards will be dynamically inserted here -->
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendarContainer" class="calendar-view" style="display: none;">
            <div class="calendar-header">
                <button class="btn btn-secondary calendar-nav" id="calendarPrevBtn">â€¹</button>
                <h2 id="calendarMonthLabel">Octubre 2025</h2>
                <button class="btn btn-secondary calendar-nav" id="calendarNextBtn">â€º</button>
            </div>

            <div id="calendarLoadingState" class="loading-state" style="display: none;">
                <div class="spinner"></div>
                <p>Cargando visitas programadas...</p>
            </div>

            <div class="calendar-grid-wrapper">
                <div class="calendar-weekdays">
                    <div>Dom</div>
                    <div>Lun</div>
                    <div>Mar</div>
                    <div>MiÃ©</div>
                    <div>Jue</div>
                    <div>Vie</div>
                    <div>SÃ¡b</div>
                </div>
                <div id="calendarDays" class="calendar-days"></div>
            </div>

            <div id="calendarEmptyState" class="empty-state" style="display: none;">
                <p>ğŸ“… No hay visitas programadas para este mes</p>
            </div>

            <div id="visitListContainer" class="visit-list" style="display: none;">
                <div class="visit-list-header">
                    <h3>Visitas Programadas</h3>
                    <span class="visit-count" id="visitListCount">0</span>
                </div>
                <div id="visitListContent" class="visit-list-content"></div>
            </div>
        </div>
    </div>

    <!-- Modal for viewing details and adding notes -->
    <div id="notesModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Notas de AprobaciÃ³n</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="approvalNotes" placeholder="Agregue notas sobre esta decisiÃ³n (opcional)..." rows="4"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                <button class="btn" id="modalActionBtn" onclick="submitModalAction()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal" style="display: none;">
        <div class="modal-content detail-modal-content">
            <div class="modal-header">
                <div>
                    <div class="detail-modal-badge" id="detailStatusBadge">Pendiente</div>
                    <h2 id="detailModalTitle">Detalle de LicitaciÃ³n</h2>
                    <div class="detail-subtitle" id="detailSubtitle"></div>
                </div>
                <button class="close-btn" id="detailModalCloseBtn">&times;</button>
            </div>
            <div class="modal-body detail-modal-body">
                <div id="detailLoading" class="detail-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Cargando detalles...</p>
                </div>
                <div id="detailContent" class="detail-content"></div>
            </div>
            <div class="modal-footer detail-modal-footer">
                <div style="display: flex; gap: 8px; margin-right: auto;">
                    <a id="detailPdfLink" class="btn btn-primary" href="#" target="_blank" rel="noopener noreferrer">ğŸ“„ Abrir PDF</a>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-danger" id="detailDeleteBtn" style="display: none;">ğŸ—‘ï¸ Eliminar</button>
                    <button class="btn btn-secondary" id="detailModalDismissBtn">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>



